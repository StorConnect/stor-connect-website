---
// Cookie Consent mit vanilla-cookieconsent Library
// Bew√§hrte, funktionierende GDPR/DSGVO-konforme L√∂sung
import 'vanilla-cookieconsent/dist/cookieconsent.css';
---

<script>
  import * as CookieConsent from 'vanilla-cookieconsent';

  console.log('[STOR] CookieConsent Modul geladen');

  document.addEventListener('DOMContentLoaded', () => {
    console.log('[STOR] Initialisiere Cookie Consent...');
    
    try {
      CookieConsent.run({
      // DSGVO-Compliance Settings
      guiOptions: {
        consentModal: {
          layout: 'box',              // Box-Layout (nicht bar)
          position: 'bottom center',  // MITTIG AM BOTTOM - GARANTIERT!
          equalWeightButtons: true,   // Alle Buttons gleich gro√ü
          flipButtons: false
        },
        preferencesModal: {
          layout: 'box',
          position: 'left',
          equalWeightButtons: true
        }
      },

      // Cookie-Kategorien
      categories: {
        necessary: {
          enabled: true,
          readOnly: true
        },
        analytics: {
          enabled: false,
          readOnly: false
        },
        marketing: {
          enabled: false,
          readOnly: false
        }
      },

      // Deutsche Texte
      language: {
        default: 'de',
        translations: {
          de: {
            consentModal: {
              title: 'üç™ Cookie-Einstellungen',
              description: 'Wir nutzen Cookies auf unserer Website. Einige von ihnen sind essenziell, w√§hrend andere uns helfen, diese Website und deine Erfahrung zu verbessern.',
              acceptAllBtn: 'Alle Cookies akzeptieren',
              acceptNecessaryBtn: 'Nur notwendige',
              showPreferencesBtn: 'Benutzerdefiniert',
              footer: `
                <a href="/impressum">Impressum</a>
                <a href="/datenschutz">Datenschutz</a>
              `
            },
            preferencesModal: {
              title: 'Cookie-Einstellungen',
              acceptAllBtn: 'Alle akzeptieren',
              acceptNecessaryBtn: 'Nur notwendige',
              savePreferencesBtn: 'Auswahl speichern',
              closeIconLabel: 'Schlie√üen',
              sections: [
                {
                  title: 'Cookie-Nutzung',
                  description: 'Wir verwenden Cookies, um die grundlegenden Funktionen der Website zu gew√§hrleisten und um Ihr Online-Erlebnis zu verbessern.'
                },
                {
                  title: 'Notwendige Cookies',
                  description: 'Diese Cookies sind f√ºr die Grundfunktionen der Website erforderlich und k√∂nnen nicht deaktiviert werden.',
                  linkedCategory: 'necessary'
                },
                {
                  title: 'Analyse-Cookies',
                  description: 'Diese Cookies helfen uns zu verstehen, wie Besucher mit unserer Website interagieren.',
                  linkedCategory: 'analytics'
                },
                {
                  title: 'Marketing-Cookies',
                  description: 'Diese Cookies erm√∂glichen erweiterte Funktionalit√§t und Personalisierung.',
                  linkedCategory: 'marketing'
                }
              ]
            }
          }
        }
      }
    });
    
    // Expose CookieConsent to window SOFORT nach run()
    window.CookieConsent = CookieConsent;
    console.log('[STOR] CookieConsent erfolgreich initialisiert und auf window exponiert');
    
    } catch (error) {
      console.error('[STOR] Fehler beim Initialisieren von CookieConsent:', error);
    }
  });
</script>

<style is:global>
/* ========================================
   STOR CONNECT - vanilla-cookieconsent Customization
   STOR Connect CI Farben
   ======================================== */

/* Consent Modal - Am Bottom */
#cc-main .cm {
  --cc-bg: #ffffff;
  --cc-primary-color: #E01D22;        /* STOR Rot */
  --cc-secondary-color: #36454F;      /* STOR Grau */
  --cc-btn-primary-bg: #E01D22;       /* STOR Rot */
  --cc-btn-primary-hover-bg: #C9302C; /* Dunkleres Rot */
  --cc-btn-secondary-bg: #f3f4f6;     /* Grau */
  --cc-btn-secondary-hover-bg: #e5e7eb;
  --cc-separator-border-color: #e5e7eb;
  --cc-font-family: 'Inter Variable', system-ui, sans-serif;
}

/* Primary Button (Alle akzeptieren) - STOR Rot */
#cc-main .cm__btn--primary {
  background-color: #E01D22 !important;
  border-color: #E01D22 !important;
  color: white !important;
}

#cc-main .cm__btn--primary:hover {
  background-color: #C9302C !important;
  border-color: #C9302C !important;
}

/* Secondary Buttons - Grau */
#cc-main .cm__btn--secondary {
  background-color: #f3f4f6 !important;
  border: 1px solid #e5e7eb !important;
  color: #36454F !important;
}

#cc-main .cm__btn--secondary:hover {
  background-color: #e5e7eb !important;
}

/* Toggle Switch - STOR Rot wenn aktiv */
#cc-main .section__toggle:checked ~ .toggle__icon {
  background-color: #E01D22 !important;
}

/* Modal am Bottom zentriert - Extra sicherstellen */
#cc-main .cm--box.cm--bottom {
  bottom: 2rem !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  max-width: 550px !important;
  margin: 0 auto !important;
}

/* Mobile: Vollbreite */
@media (max-width: 768px) {
  #cc-main .cm--box.cm--bottom {
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    max-width: 100% !important;
    border-radius: 12px 12px 0 0 !important;
  }
}

/* Button Text - Kein Overflow */
#cc-main .cm__btn {
  white-space: normal !important;
  text-align: center !important;
  padding: 0.875rem 1rem !important;
}

/* Preferences Modal */
#cc-main .pm {
  --cc-bg: #ffffff;
  --cc-primary-color: #E01D22;
  --cc-secondary-color: #36454F;
}

/* Links im Footer */
#cc-main .cm__footer a {
  color: #36454F !important;
  text-decoration: underline !important;
}

#cc-main .cm__footer a:hover {
  color: #E01D22 !important;
}
</style>
