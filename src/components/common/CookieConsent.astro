---
// Cookie Consent mit vanilla-cookieconsent Library
// Bewährte, funktionierende GDPR/DSGVO-konforme Lösung
import 'vanilla-cookieconsent/dist/cookieconsent.css';
---

<script>
  import * as CookieConsent from 'vanilla-cookieconsent';

  document.addEventListener('DOMContentLoaded', () => {
    try {
      CookieConsent.run({
      // DSGVO-Compliance Settings
      guiOptions: {
        consentModal: {
          layout: 'box',              // Box-Layout (nicht bar)
          position: 'bottom center',  // MITTIG AM BOTTOM - GARANTIERT!
          equalWeightButtons: true,   // Alle Buttons gleich groß
          flipButtons: false
        },
        preferencesModal: {
          layout: 'box',
          position: 'left',
          equalWeightButtons: true
        }
      },

      // Cookie-Kategorien
      categories: {
        necessary: {
          enabled: true,
          readOnly: true
        },
        functional: {
          enabled: false,
          readOnly: false
        },
        analytics: {
          enabled: false,
          readOnly: false
        },
        marketing: {
          enabled: false,
          readOnly: false
        }
      },

      // Deutsche Texte
      language: {
        default: 'de',
        translations: {
          de: {
            consentModal: {
              title: 'Diese Website verwendet Cookies',
              description: 'Wir verwenden Cookies und ähnliche Technologien, um Ihnen ein optimales Website-Erlebnis zu bieten. Einige Cookies sind für den Betrieb der Website technisch notwendig. Andere Cookies helfen uns, die Website und Ihr Nutzererlebnis zu verbessern.<br><br>Sie können selbst entscheiden, welche Cookie-Kategorien Sie zulassen möchten. Weitere Informationen finden Sie in unserer Datenschutzerklärung.',
              acceptAllBtn: 'Alle akzeptieren',
              acceptNecessaryBtn: 'Nur notwendige',
              showPreferencesBtn: 'Einstellungen',
              footer: `
                <a href="/impressum">Impressum</a>
                <a href="/datenschutz">Datenschutz</a>
              `
            },
            preferencesModal: {
              title: 'Cookie-Einstellungen',
              acceptAllBtn: 'Alle akzeptieren',
              acceptNecessaryBtn: 'Nur notwendige',
              savePreferencesBtn: 'Auswahl speichern',
              closeIconLabel: 'Schließen',
              sections: [
                {
                  title: 'Cookie-Nutzung',
                  description: 'Wir verwenden Cookies, um die grundlegenden Funktionen der Website zu gewährleisten und um Ihr Online-Erlebnis zu verbessern. Sie können für jede Kategorie wählen, ob Sie sie aktivieren oder deaktivieren möchten.'
                },
                {
                  title: 'Notwendige Cookies <span class="pm__badge">Immer aktiv</span>',
                  description: 'Diese Cookies sind für die Grundfunktionen der Website erforderlich und können nicht deaktiviert werden. Sie werden in der Regel nur als Reaktion auf von Ihnen vorgenommene Aktionen gesetzt, die einer Dienstanforderung entsprechen, wie z.B. das Festlegen Ihrer Datenschutzeinstellungen, das Anmelden oder das Ausfüllen von Formularen.<br><br><strong>Speicherdauer:</strong> Sitzungsbezogen / bis zu 1 Jahr',
                  linkedCategory: 'necessary'
                },
                {
                  title: 'Funktionale Cookies',
                  description: 'Diese Cookies ermöglichen erweiterte Funktionen und Personalisierung. Sie können von uns oder von Drittanbietern gesetzt werden, deren Dienste wir auf unseren Seiten verwenden. Wenn Sie diese Cookies nicht zulassen, funktionieren einige oder alle dieser Dienste möglicherweise nicht ordnungsgemäß.<br><br><strong>Speicherdauer:</strong> bis zu 1 Jahr',
                  linkedCategory: 'functional'
                },
                {
                  title: 'Analytische Cookies',
                  description: 'Diese Cookies ermöglichen es uns, Besuche und Traffic-Quellen zu zählen, damit wir die Leistung unserer Website messen und verbessern können. Sie helfen uns zu verstehen, welche Seiten am beliebtesten und welche am wenigsten beliebt sind, und zu sehen, wie sich Besucher auf der Website bewegen.<br><br><strong>Hinweis:</strong> STOR Connect verwendet derzeit KEINE Analytics-Tools.',
                  linkedCategory: 'analytics'
                },
                {
                  title: 'Marketing-Cookies',
                  description: 'Diese Cookies können über unsere Website von unseren Werbepartnern gesetzt werden. Sie können von diesen Unternehmen verwendet werden, um ein Profil Ihrer Interessen zu erstellen und Ihnen relevante Anzeigen auf anderen Websites zu zeigen.<br><br><strong>Hinweis:</strong> STOR Connect verwendet derzeit KEINE Marketing-Tools.',
                  linkedCategory: 'marketing'
                }
              ]
            }
          }
        }
      }
    });
    
    // Expose CookieConsent to window for footer link
    window.CookieConsent = CookieConsent;
    
    } catch (error) {
      console.error('CookieConsent initialization error:', error);
    }
  });
</script>

<style is:global>
/* ========================================
   STOR CONNECT - vanilla-cookieconsent Customization
   STOR Connect CI Farben
   ======================================== */

/* Consent Modal - Am Bottom */
#cc-main .cm {
  --cc-bg: #ffffff;
  --cc-primary-color: #E01D22;        /* STOR Rot */
  --cc-secondary-color: #36454F;      /* STOR Grau */
  --cc-btn-primary-bg: #E01D22;       /* STOR Rot */
  --cc-btn-primary-hover-bg: #C9302C; /* Dunkleres Rot */
  --cc-btn-secondary-bg: #f3f4f6;     /* Grau */
  --cc-btn-secondary-hover-bg: #e5e7eb;
  --cc-separator-border-color: #e5e7eb;
  --cc-font-family: 'Inter Variable', system-ui, sans-serif;
}

/* Primary Button (Alle akzeptieren) - STOR Rot */
#cc-main .cm__btn--primary {
  background-color: #E01D22 !important;
  border-color: #E01D22 !important;
  color: white !important;
}

#cc-main .cm__btn--primary:hover {
  background-color: #C9302C !important;
  border-color: #C9302C !important;
}

/* Secondary Buttons - Grau */
#cc-main .cm__btn--secondary {
  background-color: #f3f4f6 !important;
  border: 1px solid #e5e7eb !important;
  color: #36454F !important;
}

#cc-main .cm__btn--secondary:hover {
  background-color: #e5e7eb !important;
}

/* Toggle Switch - STOR Rot wenn aktiv */
#cc-main .section__toggle:checked ~ .toggle__icon {
  background-color: #E01D22 !important;
}

/* Modal am Bottom zentriert - Extra sicherstellen */
#cc-main .cm--box.cm--bottom {
  bottom: 2rem !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  max-width: 550px !important;
  margin: 0 auto !important;
}

/* Mobile: Vollbreite */
@media (max-width: 768px) {
  #cc-main .cm--box.cm--bottom {
    bottom: 0 !important;
    left: 0 !important;
    right: 0 !important;
    transform: none !important;
    max-width: 100% !important;
    border-radius: 12px 12px 0 0 !important;
  }
}

/* Button Text - Kein Overflow */
#cc-main .cm__btn {
  white-space: normal !important;
  text-align: center !important;
  padding: 0.875rem 1rem !important;
}

/* Preferences Modal */
#cc-main .pm {
  --cc-bg: #ffffff;
  --cc-primary-color: #E01D22;
  --cc-secondary-color: #36454F;
}

/* Links im Footer */
#cc-main .cm__footer a {
  color: #36454F !important;
  text-decoration: underline !important;
}

#cc-main .cm__footer a:hover {
  color: #E01D22 !important;
}
</style>
